<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Postreich Gen v5.3 | ç°çƒ¬é©¬æˆå›¢å®šåˆ¶ç‰ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --current-post-size: 16px; 
            --bg-main: #ff4500; --header-bg: #000; --header-text: #ffff00; 
            --preview-bg: #d2691e; --box-bg: #ffff00; --text-main: #000; 
            --accent-color: #ff4500; --input-bg: #ffffe0; --meta-bg: rgba(0,0,0,0.15);
            --font-pixel: 'VT323', monospace; --box-border: 2px solid #000;
        }

        /* é…è‰²æ–¹æ¡ˆåº“ */
        [data-theme="electric"] { --bg-main: #ffcc00; --header-bg: #000; --header-text: #ffcc00; --preview-bg: #ffaa00; --box-bg: #ffffcc; --text-main: #000; --accent-color: #ff4500; --input-bg: #fff; --meta-bg: rgba(0,0,0,0.1); }
        [data-theme="gray"] { --bg-main: #333; --header-bg: #666; --header-text: #fff; --preview-bg: #444; --box-bg: #ccc; --text-main: #000; --accent-color: #000; --input-bg: #eee; --meta-bg: #bbb; }
        [data-theme="classic"] { --bg-main: #4a7ebb; --header-bg: #8db1e0; --header-text: #000; --preview-bg: #608cc5; --box-bg: #fff; --text-main: #000; --accent-color: blue; --input-bg: #fff; --meta-bg: #eee; }
        [data-theme="lavender"] { --bg-main: #9b89b3; --header-bg: #d1c4e9; --header-text: #000; --preview-bg: #b39ddb; --box-bg: #fff; --text-main: #000; --accent-color: #6200ea; --input-bg: #fff; --meta-bg: #f3e5f5; }
        [data-theme="emerald"] { --bg-main: #064e3b; --header-bg: #10b981; --header-text: #000; --preview-bg: #065f46; --box-bg: #fff; --text-main: #000; --accent-color: #059669; --input-bg: #fff; --meta-bg: #d1fae5; }
        [data-theme="sepia"] { --bg-main: #70543e; --header-bg: #cba88b; --header-text: #000; --preview-bg: #8c6a50; --box-bg: #f4e4d3; --text-main: #4a3525; --accent-color: #a0522d; --input-bg: #fff; --meta-bg: #d7ccc8; }
        [data-theme="ocean"] { --bg-main: #0c4a6e; --header-bg: #38bdf8; --header-text: #000; --preview-bg: #075985; --box-bg: #fff; --text-main: #000; --accent-color: #0284c7; --input-bg: #fff; --meta-bg: #e0f2fe; }

        body {
            font-family: Verdana, sans-serif; background-color: var(--bg-main);
            margin: 0; padding: 0; color: var(--text-main); height: 100vh; display: flex; flex-direction: column;
            background-image: linear-gradient(45deg, rgba(0,0,0,0.05) 25%, transparent 25%, transparent 75%, rgba(0,0,0,0.05) 75%, rgba(0,0,0,0.05));
            background-size: 4px 4px; overflow: hidden;
        }

        header { background: var(--header-bg); border-bottom: var(--box-border); padding: 8px 20px; display: flex; justify-content: space-between; align-items: center; }
        #logo { font-family: var(--font-pixel); font-size: 28px; font-weight: bold; color: var(--header-text); }
        
        main { display: flex; flex: 1; overflow: hidden; padding: 15px; gap: 15px; }
        .col { display: flex; flex-direction: column; gap: 12px; height: 100%; }
        
        /* ä¿®æ”¹ï¼šå·¦ä¾§æ å¢åŠ æ»šåŠ¨æ¡ï¼Œé˜²æ­¢å°å±å¹•æ˜¾ç¤ºä¸å…¨ */
        .col-left { width: 230px; overflow-y: auto; flex-shrink: 0; } 
        
        .col-mid { flex: 1; background: var(--preview-bg); border: var(--box-border); box-shadow: inset 4px 4px 0px rgba(0,0,0,0.2); padding: 25px; overflow-y: auto; display: flex; justify-content: center; align-items: flex-start; scroll-behavior: smooth;}
        .col-right { width: 320px; }

        .retro-box { border: var(--box-border); background: var(--box-bg); box-shadow: 4px 4px 0px rgba(0,0,0,0.3); overflow: hidden; display: flex; flex-direction: column; }
        .retro-header { background: var(--header-bg); color: var(--header-text); padding: 8px 12px; border-bottom: var(--box-border); font-family: var(--font-pixel); font-size: 18px; line-height: 1; }
        
        /* ä¿®æ”¹ï¼šæ›´ç´§å‡‘çš„å†…è¾¹è· */
        .retro-content { padding: 10px; } 
        
        .scroll-content { overflow-y: auto; flex: 1; padding: 20px; }

        .btn { background: #c0c0c0; border: 2px outset #fff; padding: 8px; font-family: var(--font-pixel); font-size: 16px; cursor: pointer; width: 100%; font-weight: bold; margin-bottom: 5px; }
        .btn:active { border: 2px inset #fff; }
        .btn-save { background: #ffd700; border-color: #ff0; color: #000; }
        .btn-add-doc { background: #fff; border-color: #000; margin-bottom: 10px; }
        
        .btn-big-add { 
            width: 100%; padding: 15px; margin-top: 20px; 
            background: rgba(255,255,255,0.8); border: 2px dashed #000; 
            font-family: var(--font-pixel); font-size: 20px; cursor: pointer;
        }

        .doc-item { 
            padding: 10px; border: 1px solid #000; margin-bottom: 5px; 
            cursor: pointer; background: rgba(255,255,255,0.5); display: flex; justify-content: space-between; align-items: center;
        }
        .doc-item:hover { background: rgba(255,255,255,0.8); }
        .doc-item.active { background: var(--header-bg); color: var(--header-text); font-weight: bold; border: 2px solid #000; }
        .doc-del { color: red; font-weight: bold; padding: 2px 6px; cursor: pointer; font-family: monospace; }

        label { display: block; font-size: 11px; font-weight: bold; margin-bottom: 3px; margin-top: 5px; font-family: var(--font-pixel); }
        /* ä¿®æ”¹ï¼šè¾“å…¥æ¡†æ›´ç´§å‡‘ï¼Œå‡å°‘ä¸Šä¸‹ç•™ç™½ */
        input, textarea, select { width: 100%; box-sizing: border-box; border: 2px inset #eee; padding: 6px; font-size: 12px; background: var(--input-bg); color: #000; margin-bottom: 5px; }

        input[list]::-webkit-calendar-picker-indicator {
            opacity: 1; cursor: pointer; background-color: rgba(0,0,0,0.1); padding: 4px; border-radius: 2px;
        }

        .avatar-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .av-cell { 
            aspect-ratio: 1; border: 1px solid #000; cursor: pointer; background-color: #fff; 
            background-size: 12px 12px; background-position: center center; background-repeat: repeat; 
        }
        .av-cell.active { outline: 3px solid var(--accent-color); transform: scale(1.1); z-index: 5; }
        
        .p1 { background-image: linear-gradient(45deg, #000 25%, transparent 25%), linear-gradient(-45deg, #000 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #000 75%), linear-gradient(-45deg, transparent 75%, #000 75%); background-size: 8px 8px; }
        .p2 { background-image: radial-gradient(#000 25%, transparent 25%); background-size: 4px 4px; }
        .p3 { background-image: linear-gradient(90deg, #000 50%, transparent 50%); background-size: 4px 4px; }
        .p4 { background-image: linear-gradient(#000 50%, transparent 50%); background-size: 4px 4px; }
        .p5 { background-image: linear-gradient(45deg, #000 10%, transparent 10%, transparent 90%, #000 90%); background-size: 8px 8px; }
        .p6 { background-image: repeating-linear-gradient(45deg, #000, #000 1px, transparent 1px, transparent 4px); }
        .p7 { background-image: radial-gradient(circle, #000 1px, transparent 1px); background-size: 8px 8px; }
        .p8 { background-image: conic-gradient(#000 90deg, #fff 90deg 180deg, #000 180deg 270deg, #fff 270deg); background-size: 8px 8px; }
        .p9 { background-image: repeating-conic-gradient(#000 0% 25%, #fff 0% 50%); background-size: 12px 12px; }
        .p10 { background-image: linear-gradient(45deg, #000 25%, #777 25%, #777 50%, #000 50%, #000 75%, #777 75%, #777 100%); background-size: 10px 10px;}
        .p11 { background-color: #000; background-image: radial-gradient(#fff 30%, transparent 30%); background-size: 6px 6px; }
        .p12 { background-image: repeating-linear-gradient(-45deg, #000, #000 2px, #fff 2px, #fff 4px); }
        .p13 { background-image: linear-gradient(45deg, #000 25%, transparent 25%, transparent 75%, #000 75%, #000), linear-gradient(45deg, #000 25%, transparent 25%, transparent 75%, #000 75%, #000); background-position: 0 0, 4px 4px; background-size: 8px 8px; }
        .p14 { background-image: linear-gradient(0deg, #000 1px, transparent 1px), linear-gradient(90deg, #000 1px, transparent 1px); background-size: 10px 10px; }
        .p15 { background-image: linear-gradient(45deg, #000 25%, transparent 25%), linear-gradient(-45deg, #000 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #000 75%), linear-gradient(-45deg, transparent 75%, #000 75%); background-size: 12px 12px; }
        .p16 { background-image: radial-gradient(circle, transparent 20%, #000 20%, #000 40%, transparent 40%, transparent 60%, #000 60%, #000 80%, transparent 80%); background-size: 10px 10px; }

        #preview-wrap { width: 100%; max-width: 600px; display: flex; flex-direction: column; gap: 20px; padding-bottom: 20px; }
        .card { border: var(--box-border); background: var(--box-bg); box-shadow: 6px 6px 0px rgba(0,0,0,0.4); position: relative; cursor: pointer; transition: transform 0.1s; }
        .card.reply { margin-left: 40px; width: calc(100% - 40px); }
        .card.editing-focus { outline: 4px solid #ff0000; outline-offset: 4px; z-index: 10; animation: blink 0.8s infinite; }
        @keyframes blink { 0% { outline-color: #ff0000; } 50% { outline-color: transparent; } 100% { outline-color: #ff0000; } }
        .card-del-btn { position: absolute; top: 0; right: 0; background: red; color: white; border: 1px solid #000; padding: 2px 6px; font-size: 10px; display: none; z-index: 20; }
        .card:hover .card-del-btn { display: block; }
        
        .card-top { 
            font-size: 11px; border-bottom: 1px solid #000; padding: 7px 12px; background: var(--meta-bg); 
            display: flex; justify-content: flex-start; align-items: center; gap: 5px;
            font-weight: bold; 
        }
        
        .user-link { color: var(--accent-color); text-decoration: underline; }
        .card-body { padding: 20px; display: flex; gap: 18px; }
        .card-av { width: 55px; height: 55px; border: var(--box-border); flex-shrink: 0; background-color: #fff; background-position: center center; background-repeat: repeat; }
        .card-text { font-size: var(--current-post-size); line-height: 1.6; white-space: pre-wrap; flex: 1; color: #000; }
        .card-img { max-width: 100%; border: 1px solid #000; margin-top: 15px; display: block; }
        .copyright { margin-top: 20px; text-align: center; font-size: 10px; font-family: var(--font-pixel); opacity: 0.6; }
    </style>
</head>
<body data-theme="orange">

<header>
    <div id="logo">Postreich::gen v5.3</div>
    <button class="btn btn-save" style="width:auto" onclick="exportImg()">ğŸ’¾å¯¼å‡ºå›¾ç‰‡</button>
</header>

<main>
    <div class="col col-left">
        <!-- SYSTEM ç›’å­çš„å†…å®¹æ ·å¼å·²å‹ç¼© -->
        <div class="retro-box" style="flex: 0 0 auto;">
            <div class="retro-header">::: SYSTEM</div>
            <div class="retro-content">
                <label>THEME é…è‰²æ–¹æ¡ˆ</label>
                <select id="sel-theme" onchange="updateDocSetting('theme', this.value)">
                    <option value="orange">1. é«˜äº®æ©™</option>
                    <option value="electric">2. ç”µåŠ›é‡‘</option>
                    <option value="gray">3. å•è‰²ç°</option>
                    <option value="classic">4. ç»å…¸è“</option>
                    <option value="lavender">5. æŸ”å’Œç´«</option>
                    <option value="emerald">6. æ·±é‚ƒç»¿</option>
                    <option value="sepia">7. å¤å¤æ£•</option>
                    <option value="ocean">8. æ·±æµ·è“</option>
                </select>
                <label>POST FONT SIZE å­—å·</label>
                <select id="sel-fontsize" onchange="updateFontSize(this.value)">
                    <option value="12px">12px</option>
                    <option value="14px">14px</option>
                    <option value="16px" selected>16px</option>
                    <option value="18px">18px</option>
                    <option value="20px">20px</option>
                </select>
                <label>AVATAR DISPLAY</label>
                <select id="sel-method" onchange="updateDocSetting('method', this.value)">
                    <option value="all">æ˜¾ç¤ºå…¨éƒ¨</option>
                    <option value="op">ä»…æ¥¼ä¸»</option>
                    <option value="none">å…³é—­</option>
                </select>
                
                <div style="border-top: 2px dashed #000; margin-top: 10px; padding-top: 8px;">
                    <label>ROSTER å¸¸ç”¨åå• (ä¸€è¡Œä¸€ä¸ª)</label>
                    <textarea id="ed-roster" rows="6" oninput="updateUserList()" placeholder="è¾“å…¥åå­—ï¼Œä¸€è¡Œä¸€ä¸ª..."></textarea>
                </div>
            </div>
        </div>
        <div class="retro-box" style="flex:1; margin-top: 12px; min-height: 200px;">
            <div class="retro-header">::: AVATAR</div>
            <div class="retro-content"><div class="avatar-grid" id="av-box"></div></div>
            <div class="copyright">ç‰ˆæƒæ‰€æœ‰ @ç°çƒ¬é©¬æˆå›¢</div>
        </div>
    </div>

    <div class="col-mid">
        <div style="width:100%; max-width:600px;">
            <div id="preview-wrap"></div>
            <button class="btn-big-add" onclick="addFloor()">+ ADD REPLY / å¢åŠ å›å¤</button>
        </div>
    </div>

    <div class="col col-right">
        <div class="retro-box" style="height:260px; flex-shrink: 0;">
            <div class="retro-header">::: DOCUMENTS / æ–‡æ¡£</div>
            <div id="doc-list-box" style="overflow-y:auto; flex:1; padding: 10px;"></div>
            <button class="btn btn-add-doc" onclick="createNewDoc()">+ NEW THREAD / æ–°å»ºå¸–å­</button>
        </div>

        <div class="retro-box" style="flex:1; margin-top: 12px; min-height: 0;">
            <div class="retro-header">::: EDIT [<span id="edit-id">æ¥¼ä¸»</span>]</div>
            <div class="scroll-content">
                <label>USER ç”¨æˆ·å</label>
                <input type="text" id="ed-user" list="user-history" 
                       onfocus="this.value='';" 
                       oninput="applyEdit()" 
                       placeholder="ç‚¹å‡»é€‰æ‹©æˆ–æ‰‹åŠ¨è¾“å…¥...">
                <datalist id="user-history"></datalist>

                <label>CONTENT å†…å®¹æ­£æ–‡</label>
                <textarea id="ed-text" rows="8" oninput="applyEdit()"></textarea>
                <label>IMAGE æ’å…¥å›¾ç‰‡</label>
                <input type="file" accept="image/*" onchange="hdlImg(event)">
                <button id="btn-del-img" class="btn" style="font-size:10px; display:none" onclick="clrImg()">æ¸…é™¤å›¾ç‰‡</button>
            </div>
        </div>
    </div>
</main>

<script>
    const guideText = `æ¬¢è¿ä½¿ç”¨ Postreich Gen v5.3 (ç°çƒ¬é©¬æˆå›¢å®šåˆ¶ç‰ˆ)

[å¿«é€Ÿä¸Šæ‰‹æŒ‡å—]

1. è§’è‰²ç®¡ç† (NEW!):
   è¯·çœ‹å·¦ä¾§ [ROSTER] æ–‡æœ¬æ¡†ã€‚åœ¨è¿™é‡Œè¾“å…¥å¸¸ç”¨è§’è‰²åï¼ˆä¸€è¡Œä¸€ä¸ªï¼‰ã€‚
   è¾“å…¥åï¼Œåœ¨å³ä¾§ [USER] è¾“å…¥æ¡†ç‚¹ä¸€ä¸‹å°±èƒ½çœ‹åˆ°ä¸‹æ‹‰åå•ã€‚

2. ç¼–è¾‘å†…å®¹:
   ç‚¹å‡»ä¸­é—´é¢„è§ˆåŒºçš„æ¥¼å±‚ï¼Œåœ¨å³ä¾§ [EDIT] é¢æ¿ä¿®æ”¹æ–‡å­—ã€ä¸Šä¼ å›¾ç‰‡ã€‚
   ç‚¹å‡»åº•éƒ¨çš„ [ADD REPLY] å¢åŠ æ¥¼å±‚ã€‚

3. ä¸ªæ€§åŒ–:
   å·¦ä¾§é€‰æ‹© [THEME] æ¢è‚¤ï¼Œç‚¹å‡»ä¸‹æ–¹ [AVATAR] æ ¼å­æ¢å¤´åƒã€‚
   æ•°æ®è‡ªåŠ¨ä¿å­˜åœ¨æµè§ˆå™¨ä¸­ã€‚

4. å¯¼å‡º:
   ç‚¹å‡»é¡¶éƒ¨ [å¯¼å‡ºå›¾ç‰‡] å³å¯ç”Ÿæˆé•¿å›¾ã€‚`;

    let appState = {
        activeDocId: 0,
        rosterText: "ADMIN\nåŒ¿åç”¨æˆ·\nä¸»æŒäºº\néª°å­", 
        docs: [
            { id: 0, theme: 'orange', method: 'all', posts: [{ user: 'ADMIN', text: guideText, av: 'p1', img: null }], activePostIdx: 0 }
        ]
    };

    function init() {
        const saved = localStorage.getItem('postreich_v53');
        if(saved) appState = JSON.parse(saved);
        
        if(!appState.rosterText) appState.rosterText = "ADMIN\nåŒ¿åç”¨æˆ·";
        document.getElementById('ed-roster').value = appState.rosterText;
        updateUserList(); 

        const grid = document.getElementById('av-box');
        for(let i=1; i<=16; i++){
            const d = document.createElement('div'); d.className = `av-cell p${i}`;
            d.onclick = () => { getCurrentDoc().posts[getCurrentDoc().activePostIdx].av = `p${i}`; renderAll(); };
            grid.appendChild(d);
        }
        renderAll();
    }

    function updateUserList() {
        const text = document.getElementById('ed-roster').value;
        appState.rosterText = text; 
        
        const dl = document.getElementById('user-history');
        dl.innerHTML = '';
        const lines = text.split('\n');
        [...new Set(lines)].forEach(line => {
            const val = line.trim();
            if(val) {
                const opt = document.createElement('option');
                opt.value = val;
                dl.appendChild(opt);
            }
        });
        localStorage.setItem('postreich_v53', JSON.stringify(appState));
    }

    function getCurrentDoc() { return appState.docs.find(d => d.id === appState.activeDocId); }

    function renderAll() {
        const doc = getCurrentDoc(); if (!doc) return;
        document.body.setAttribute('data-theme', doc.theme);
        document.getElementById('sel-theme').value = doc.theme;
        document.getElementById('sel-method').value = doc.method;

        // æ–‡æ¡£åˆ—è¡¨
        const docList = document.getElementById('doc-list-box');
        docList.innerHTML = '';
        appState.docs.forEach((d) => {
            const div = document.createElement('div');
            div.className = `doc-item ${d.id === appState.activeDocId ? 'active' : ''}`;
            div.onclick = () => switchDoc(d.id);
            const titleText = d.posts[0].text ? d.posts[0].text.substring(0, 10) : 'Untitled';
            const delBtn = appState.docs.length > 1 ? `<span class="doc-del" onclick="event.stopPropagation(); deleteDoc(${d.id})">x</span>` : '';
            div.innerHTML = `<span>${titleText}...</span>${delBtn}`;
            docList.appendChild(div);
        });

        // é¢„è§ˆåŒº
        const wrap = document.getElementById('preview-wrap');
        wrap.innerHTML = '';
        doc.posts.forEach((p, i) => {
            const card = document.createElement('div');
            card.className = `card ${i>0?'reply':''} ${doc.activePostIdx===i ? 'editing-focus' : ''}`;
            card.onclick = () => { selectPost(i); }; 
            let showAv = (doc.method==='all') || (doc.method==='op' && i===0);
            card.innerHTML = `<div class="card-del-btn" onclick="event.stopPropagation(); deletePost(${i})">X</div>
                <div class="card-top">FROM: <span class="user-link">${p.user}</span></div>
                <div class="card-body">
                    ${showAv ? `<div class="card-av ${p.av}"></div>` : ''}
                    <div class="card-text">${p.text}${p.img?`<img src="${p.img}" class="card-img">`:''}</div>
                </div>`;
            wrap.appendChild(card);
        });

        // ç¼–è¾‘åŒºåŒæ­¥
        const curPost = doc.posts[doc.activePostIdx];
        if (curPost) {
            document.getElementById('edit-id').innerText = doc.activePostIdx===0?'æ¥¼ä¸»':'å›å¤ '+doc.activePostIdx;
            document.getElementById('ed-user').value = curPost.user;
            document.getElementById('ed-text').value = curPost.text;
            document.getElementById('btn-del-img').style.display = curPost.img?'block':'none';
            document.querySelectorAll('.av-cell').forEach(el => el.classList.toggle('active', el.classList.contains(curPost.av)));
        }
        localStorage.setItem('postreich_v53', JSON.stringify(appState));
    }

    function createNewDoc() {
        const id = Date.now();
        appState.docs.push({ id, theme: 'orange', method: 'all', posts: [{ user: 'NEW_OP', text: 'æ–°å¸–å­...', av: 'p1', img: null }], activePostIdx: 0 });
        appState.activeDocId = id; renderAll();
    }
    function switchDoc(id) { appState.activeDocId = id; renderAll(); }
    function deleteDoc(id) { if(confirm('åˆ é™¤æ•´ä¸ªæ–‡æ¡£ï¼Ÿ')) { appState.docs = appState.docs.filter(d => d.id !== id); if(appState.docs.length===0) createNewDoc(); else appState.activeDocId = appState.docs[0].id; renderAll(); } }
    function selectPost(i) { getCurrentDoc().activePostIdx = i; renderAll(); }
    function addFloor() { const doc = getCurrentDoc(); doc.posts.push({ user: 'User', text: '', av: 'p1', img: null }); doc.activePostIdx = doc.posts.length - 1; renderAll(); }
    function deletePost(i) { if(i===0) return alert('æ¥¼ä¸»ä¸èƒ½åˆ '); if(confirm('åˆ è¿™æ¥¼ï¼Ÿ')) { const d = getCurrentDoc(); d.posts.splice(i, 1); d.activePostIdx = 0; renderAll(); } }
    
    function applyEdit() {
        const doc = getCurrentDoc(); const p = doc.posts[doc.activePostIdx];
        p.user = document.getElementById('ed-user').value;
        p.text = document.getElementById('ed-text').value;
        renderAll();
    }

    function updateDocSetting(k, v) { getCurrentDoc()[k] = v; renderAll(); }
    function updateFontSize(v) { document.documentElement.style.setProperty('--current-post-size', v); }
    function hdlImg(e) { const f = e.target.files[0]; if(!f) return; const r = new FileReader(); r.onload = (ev) => { getCurrentDoc().posts[getCurrentDoc().activePostIdx].img = ev.target.result; renderAll(); }; r.readAsDataURL(f); }
    function clrImg() { getCurrentDoc().posts[getCurrentDoc().activePostIdx].img = null; renderAll(); }
    
    function exportImg() {
        const area = document.getElementById('preview-wrap');
        const bg = getComputedStyle(document.querySelector('.col-mid')).backgroundColor;
        document.querySelectorAll('.editing-focus').forEach(el => el.classList.remove('editing-focus'));
        area.style.padding = "40px"; 
        html2canvas(area, { backgroundColor: bg, scale: 2, useCORS: true }).then(canvas => {
            area.style.padding = "0px";
            const l = document.createElement('a'); l.download = `post_${Date.now()}.png`; l.href = canvas.toDataURL(); l.click();
            renderAll();
        });
    }
    window.onload = init;
</script>
</body>
</html>